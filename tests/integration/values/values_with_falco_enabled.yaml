sumologic:
  setupEnabled: false
  accessId: "dummy"
  accessKey: "dummy"
  endpoint: http://receiver-mock.receiver-mock:3000/terraform/api/

# Prevent snowball effect by filtering out receiver mock logs
fluent-bit:
  config:
    filters: |
      [FILTER]
          Name    grep
          Match   containers.var.log.containers.receiver-mock*
          Exclude log .*

# Request less resources so that this fits on Github actions runners environment
kube-prometheus-stack:
  prometheus:
    prometheusSpec:
      resources:
        limits:
          cpu: 100m
          memory: 64Mi
        requests:
          cpu: 100m
          memory: 64Mi

# Request less resources so that this fits on Github actions runners environment
fluentd:
  logs:
    statefulset:
      replicaCount: 1
      resources:
        limits:
          memory: 64Mi
          cpu: 100m
        requests:
          memory: 64Mi
          cpu: 100m
  metrics:
    statefulset:
      replicaCount: 1
      resources:
        limits:
          memory: 64Mi
          cpu: 100m
        requests:
          memory: 64Mi
          cpu: 100m
  events:
    statefulset:
      resources:
        limits:
          memory: 64Mi
          cpu: 100m
        requests:
          memory: 64Mi
          cpu: 100m

falco:
  enabled: true
  image:
    # registry: public.ecr.aws
    # repository: sumologic/falco
    registry: docker.io
    repository: falcosecurity/falco-no-driver
  # extraInitContainers:
  #   - name: init-falco
  #     image: busybox
  #     command:
  #       - 'sh'
  #       - '-c'
  #       - ls -C /host/dev/ && whoami
  #     volumeMounts:
  #       - mountPath: /host/dev
  #         name: dev-fs
  #         readOnly: true
  #       - mountPath: /host/proc
  #         name: proc-fs
  #         readOnly: true
  #       - mountPath: /host/lib/modules
  #         name: lib-modules
  #       - mountPath: /host/usr
  #         name: usr-fs
  #         readOnly: true

  extraInitContainers:
    - name: init-driverloader
      image: falcosecurity/falco-driver-loader:0.30.0
      env:
        - name: BPF_USE_LOCAL_KERNEL_SOURCES
          value: "true"
      command: ["/bin/bash"]
      args:
        - "-c"
        - |
          apt update
          apt install -f -y
          apt install -y flex bison
          apt install -y gcc libssl-dev
          ls -l /var/
          ls -l /var/lib/
          ls -l /var/lib/dkms/
          ls -l /var/lib/dkms/falco/
          ls -l /var/lib/dkms/falco/3aa7a83bf7b9e6229a3824e3fd1f4452d1e95cb4/
          ls -l /var/lib/dkms/falco/3aa7a83bf7b9e6229a3824e3fd1f4452d1e95cb4/build/
          whoami
          falco-driver-loader module --compile
      volumeMounts:
      - mountPath: /host/dev
        name: dev-fs
        readOnly: true
      - mountPath: /host/proc
        name: proc-fs
        readOnly: true
      - mountPath: /host/boot
        name: boot-fs
        readOnly: true
      - mountPath: /host/lib/modules
        name: lib-modules
      - mountPath: /host/usr
        name: usr-fs
        readOnly: true
      - mountPath: /host/etc
        name: etc-fs
        readOnly: true
